### 고객을 쪼개는 방법, RFM 분석
고객을 묶을 때 3가지 기준으로 나누어 분석함
- Recency: 얼마나 최근에 구매했는지
- Frequency: 알마나 자주 구매했는지
- Monetary: 얼마나 많은 금액을 구매했는지

### RFM 분석과정
1. 고객별로 Recency/Frequency/Monetary 수치 산출
2. R/F/M 각각에 대해 등급 만들어주기 
     - 25%씩 나누어 1등급, 2등급, 3등급, 4등급으로 함
     - Frequency & Monetary는 클수록 높은 점수
     - Recency는 작을수록 높은 점수
3. RFM 그룹과 RFM 점수 산출
     - RFM 그룹: 각 R/F/M 등급을 차례로 적어줌
          - 413그룹 = 최근에(4), 아주 가끔(1), 꽤 많은 금액(3)을 쓴 고객
          - 144그룹 = 온지 오래되었지만(1), 자주(4), 많이 산(4) 고객
          - 322그룹 = 꽤 최근에(3), 약간 자주(2), 금액은 그리 크지 않게(2) 구매한 고객
     - RFM 점수: 각 R/F/M 등급의 합
     - RFM 점수가 클수록 우수한 고객
     - 구해진 RFM 점수를 이용해 커스텀 등급을 매김(실버(5<=점수<9), 골드(점수>=9), 브론즈(점수<5))
     - 같음 점수이어도 R/F/M의 차이가 존재할텐데 이를 알 수 없음
4. 각 그룹에 맞는 메시지 정하기
     - VVIP(444)
          - 최근에, 가장 자주, 가장 많은 금액을 쓰는 그룹
          - 잘 지켜야 하는 고객
          - 가지 있고 중요한 고객이라는 점을 지속적으로 전달
          - 파레토 법칙 (20%고객이 80%의 매출을 담당한다)
     - 중요신규고객(414, 413)
          - 최근에, 한번, 큰 금액을 쓴 그룹
          - 신규 중에서도 VIP가 될 가능성이 높은 고객
          - 이러한 고객들이 추후 어떤 그룹으로 이동했는지 분석도 유의미함
     - Low-Spending 충성고객(442, 441)
          - 최근에, 자주, 적은 금액을 쓴 그룹
          - 보랜드 로열티 있음
          - 크로스셀과 업셀로 Spend-Level을 높일 필요
     - 이탈한 충성고객(144, 143, 134, 133)
          - 자주, 많은 금액을 소비했는데 이용한지 오래된 그룹
          - 이탈했지만 다시 데려오는 시도를 해 볼 만한 고객

### RFM 분석 업무에 적용하기
RFM 등급 나누는 방법
- 4개 그룹 (25%씩 4개 그룹)
- 2개 그룹 (파레토 법칙에 의거, 20%와 80%)
- 도메인에 맞게 자체 기준
    - 연간 300만원 이상
    - 연간 100만원 이상 300만원 이하
    - 연간 100만원 이하
- 5개 이상의 그룹은 지양하는 것이 좋다
- 구매가 없을 때는 
    - Monetary에 매출 대신 engagement 지표를 활용한다
    - 어플 - 방문 페이지수
    - 영상, 콘텐츠 - 총 시청시간
    - 앱, 웹 서비스 - 사이트 체류시간
    - R과 F만 사용해도 유의미하다
- R, F, M 중 더 중요한 요소에는 가중치를 준다
    -  RFM = Recency점수 + Frequency점수 + Monetary점수
    -  RFM = a*Recency점수 + b*Frequency점수 + c*Monetary점수
         - 화장품 회사 - 자주, 최근에 사는게 중요하다(a=1, b=1, c=0.7)
         - 가전제품 - 최근에 비싸게 사는게 중요하다(a=1, b=0.8, c=1.2)
         - 실무에서 가중치를 구할 때 도메인 지식에 맞게 더 중요한 부분에 중점을 둔다

### RFM 실습
```sql
select customer_id, MAX(invoice_date) recent_purchase, count(invoice_no) frequency, sum(quantity*unit_price) monetary, 
       DATE_DIFF(DATE('2022-12-10'), DATE(MAX(invoice_date)), DAY) recency
from data.sales
group by customer_id
```
고객을 그룹화하고 score를 구하는 작업은 excel에서 진행 가능합니다. 

### 정리
각 고객을 여정을 단계별로 나눠서 각 단계별 전환율을 구하는 퍼널분석을 통해서 
어디에 집중해서 서비스를 개선해야하는지 포인트를 찾는 분석을 할 수 있다.

코호트분석을 통해서 
우리가 데려온 고객을 얼마나 잘 지키고 있는지 측정할 수 있다.

RFM분석에서 고객을 잘 지키지 위해서 
고객별로 적정한 메시지를 보내줘야하는데
그 고객들은 어떻게 그룹화할지 세크먼트하는 방법에 대해서 위와 같이 알아봤음
